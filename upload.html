<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>上传作品</title>
    <link rel="stylesheet" href="layui-master/dist/css/layui.css">
    <link rel="stylesheet" href="style/css/index.css">


</head>
<body id="upload_body">

<div class="zero"></div>
<div class="layui-container true_body">
    <div class="layui-row">
        <div class="layui-col-md8 layui-col-md-offset2 up_body">
            <div class="layui-cow">
                <div class="message">
                    西安邮电大学网站和互联网应用评比报名
                </div>
                <div id="darkbannerwrap"></div>
            </div>

            <div style="position: absolute;right: 5px;bottom: 5px">
                <button class="layui-btn" style="width: 170px;height: 50px;display: block;margin: 6px auto;"> <a style="color: white" href="http://wzpb.xupt.org/style/img/西安邮电大学网站和互联网应用评比申请表.zip" style="display: block"> <i class="layui-icon">&#xe67c;</i>报名表格补下载 </a> </button>
            </div>

            <div class="layui-cow up_form">
                <div class="layui-col-md-12">
                    <form id="page_one" class="layui-form layui-form-pane" lay-filter="test2">
                        <div class="layui-form-item">
                            <label class="layui-form-label">应用/网站名称</label>
                            <div class="layui-input-inline">
                                <input type="text" name="no_name" placeholder="请输入应用/网站名" lay-verify="required|a_name" class="layui-input" autocomplete="off">
                            </div>
                            <div class="layui-form-mid layui-word-aux" id="the_tip"> </div>
                        </div>

                        <div class="layui-form-item" style="display: none;">
                            <div class="layui-input-inline">
                                <input type="text" name="a_name" lay-verify="required|a_name" class="layui-input" autocomplete="off">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">单位名称</label>
                            <div class="layui-input-block">
                                <input type="text" name="u_name" lay-verify="required|u_name" placeholder="请输入学院/单位名称" class="layui-input">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">访问方式/域名</label>
                            <div class="layui-input-block">
                                <input type="text" name="url" lay-verify="required|the_url" placeholder="例如：https://zypc.xupt.edu.cn 或者 西邮在线" class="layui-input">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <label class="layui-form-label">负责人信息</label>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="manager" lay-verify="required|name" placeholder="姓名" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid">-</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="m_id" placeholder="学号/工号" lay-verify="required|name_id" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid">-</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="m_class" placeholder="部门/班级" lay-verify="required|class_id" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid">-</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="m_phone" placeholder="手机号码" lay-verify="required|the_phone" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>

                        <div class="layui-form-item" id="add_input">
                            <div class="layui-inline">
                                <label class="layui-form-label">参与人员信息</label>

                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="admin" placeholder="姓名" lay-verify="name" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid">-</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="a_id" placeholder="学号/工号" lay-verify="name_id" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid">-</div>
                                <div class="layui-input-inline" style="width: 100px;">
                                    <input type="text" name="a_class" placeholder="部门/班级" lay-verify="class_id" autocomplete="off" class="layui-input">
                                </div>
                                <div class="layui-form-mid layui-word-aux">
                                    <div class="layui-btn-group">
                                        <button class="layui-btn layui-btn-mini" id="the_more" type="button">
                                            <i class="layui-icon">&#xe654;</i> 添加(最多五个)
                                        </button>
                                        <button class="layui-btn layui-btn-mini" type="button" id="the_del">
                                            <i class="layui-icon">&#xe640;</i> 删除
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">应用建立时间</label>
                            <div class="layui-input-block">
                                <input type="text" name="time"  lay-verify="required" placeholder="请选择应用建立时间" class="layui-input" id="the_time" autocomplete="off">
                            </div>
                        </div>

                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">基本情况介绍</label>
                            <div class="layui-input-block">
                                <textarea name="b_position" placeholder="请输入基本情况介绍"  lay-verify="required|the_text" class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">使用情况介绍</label>
                            <div class="layui-input-block">
                                <textarea name="u_position" placeholder="请输入使用情况介绍" lay-verify="required|the_text" class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">日常管理介绍</label>
                            <div class="layui-input-block">
                                <textarea name="d_position" placeholder="请输入日常管理介绍" lay-verify="required|the_text" class="layui-textarea"></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item layui-form-text">
                            <label class="layui-form-label">应用特色介绍</label>
                            <div class="layui-input-block">
                                <textarea name="a_position" placeholder="请输入应用特色介绍" lay-verify="required|the_text" class="layui-textarea"></textarea>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">类似比赛经历</label>
                            <div class="layui-input-block">
                                <input type="checkbox"  lay-verify="required" name="flag" lay-skin="switch" lay-text="是|否" value="1">
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <label class="layui-form-label">选择参赛类型</label>
                            <div class="layui-input-block">
                                <select name="type" lay-verify="required">
                                    <option value=""></option>
                                    <option value="1">互联网应用组</option>
                                    <option value="2">特色网站组</option>
                                </select>
                            </div>
                        </div>

                        <div class="layui-form-item">
                            <div class="layui-input-block fine_up">
                                <button id="up_all" class="layui-btn" lay-filter="go" type="button" lay-submit style="width: 70%">提交</button>
                            </div>
                        </div>
                        <span style="text-align: center;display: block;color: #FF5722">相同作品只能提交一次，请谨慎提交</span>
                    </form>

                    <div style="display: none" id="page_two" class="page_two">
                        <div>
                            <h2>请下载纸质表格填写后送至信息中心A502进行审核</h2>
                            <h3>为了您的作品的最佳观赏效果，图片上传请按照3：4比例上传</h3>
                            <span style="color: #FF5722">格式限制为：jpg|png|gif 最大为10M</span>
                            <h3 style="margin-top: 3rem">咨询电话：88166125</h3>
                        </div>
                        <div class="layui-row">
                            <div class="layui-col-md6 layui-col-md-offset3" style="text-align: center">
                                <button class="layui-btn up_file" id="up_file" style="margin-top: 40px;width: 60%;height: 50px">
                                    <i class="layui-icon">&#xe67c;</i>选择展示图片
                                </button>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="layui-col-md6 layui-col-md-offset3" style="text-align: center">
                                <button class="layui-btn" id="up_img"  style="margin-top: 40px;width: 77%;height: 65px">
                                    <i class="layui-icon">&#xe67c;</i>确定上传
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row upload_foot">
        <div class="layui-col-md2 layui-col-md-offset10">
            <div class="thefooter">
                © 2017 by <a href="https://zypc.xupt.edu.cn" target="_blank">智邮普创工作室</a>
            </div>
        </div>
    </div>
</div>


<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
<script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
<script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->



<script src="layui-master/dist/layui.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script src="style/js/JSON-js-master/json2.js"></script>


<script>
    layui.use(['layer', 'form','laydate','upload'], function(){
        var layer = layui.layer
            ,form = layui.form
            ,laydate = layui.laydate
            ,upload = layui.upload;
        //执行一个laydate实例
        laydate.render({
            elem: '#the_time' //指定元素
            ,max: '2017-10-24'
        });


        //表单验证模块
        form.verify({
            a_name : [
                /^[\w、""():“”（）：\u4e00-\u9fa5]{1,40}$/,
                '应用名不能超过二十个中文字符并且只限普通字符哦'
            ],
            u_name : [
                /^[\w、""():“”（）：\u4e00-\u9fa5]{1,40}$/,
                '单位名不能超过二十个中文字符并且只限普通字符哦'
            ],
            the_url :[
                /^[\.:：\/\w、""():“”（）：\u4e00-\u9fa5]{1,50}$/,
                '访问方式请勿超过五十个字符并且为合法哦'
            ],
            name:[
                /^[\u4e00-\u9fa5]{1,20}$|^$/,
                '姓名必须为中文字符'
            ],
            name_id:[
                /^[\u4e00-\u9fa5\d]{1,30}$|^$/,
                '学号请勿超过十五个中文字符哦'
            ],
            class_id:[
                /^[\d\u4e00-\u9fa5]{1,40}$|^$/,
                '班级代号请勿超过二十个中文字符哦'
            ],
            the_text:[
                /^[.\S\s]{1,1000}$/,
                '介绍正文请勿超过五百个中文字符哦'
            ],
            the_phone:[
                /^[\d]{1,11}$/,
                '无效的电话号码'
            ]


        });



        function gogogo() {
            upload.render({
                elem: '.up_file'
                , url: 'upload.php'
                , exts: 'jpg|png|gif'
                , size: 10240
                , auto: false
                , bindAction: '#up_img'
                , data: {
                    m: localStorage.getItem("type"),
                    n: localStorage.getItem("a_name")
                }
                , done: function (res, index, upload) {
                    layer.open({
                        type: 1,
                        title:'报名成功',
                        area: ['500px', '300px'],
                        content: '<button class="layui-btn" style="width: 60%;height: 50px;display: block;margin: 0 auto;margin-top: 100px"> <a href="http://wzpb.xupt.org/style/img/西安邮电大学网站和互联网应用评比申请表.zip" style="display: block"> <i class="layui-icon">&#xe67c;</i>下载报名表格 </a> </button>' ,
                        end: function(){
                            window.location.href="http://iweb.xupt.edu.cn/";
                        }
                    });
                }
                , error: function () {
                    layer.open({
                        type: 1,
                        title:'报名成功',
                        area: ['500px', '300px'],
                        content: '<button class="layui-btn" style="width: 60%;height: 50px;display: block;margin: 0 auto;margin-top: 100px"> <a href="http://wzpb.xupt.org/style/img/西安邮电大学网站和互联网应用评比申请表.zip" style="display: block"> <i class="layui-icon">&#xe67c;</i>下载报名表格 </a> </button>' ,
                        end: function(){
                            window.location.href="http://iweb.xupt.edu.cn/";
                        }
                    });
                }
            });
        }
        form.on('submit(go)', function(data) {
            //获取全部表单值

            localStorage.setItem("a_name",data.field.a_name);
            localStorage.setItem("type",data.field.type);

                var the_flag = 0;
                if (data.field.flag == 1) {
                    the_flag = 1;
                } else {
                    the_flag = 0;
                }

            //提取为字符串
            var all_admin = data.field.admin +',' + data.field.admin2 +',' + data.field.admin3 +',' + data.field.admin4 +',' + data.field.admin5;
            var all_aid = data.field.a_id +',' + data.field.a_id2 +',' + data.field.a_id3 +',' + data.field.a_id4 +',' + data.field.a_id5;
            var all_aclass = data.field.a_class +',' + data.field.a_class2 +',' + data.field.a_class3 +',' + data.field.a_class4 +',' + data.field.a_class5;

            //剔除无效值
            var rm_admin = all_admin.replace(/undefined/g,"");
            var rm_aid = all_aid.replace(/undefined/g,"");
            var rm_aclass = all_aclass.replace(/undefined/g,"");

            //合成数组
            var make_admin = rm_admin.split(/,/);
            var make_aid = rm_aid.split(/,/);
            var make_aclass = rm_aclass.split(/,/);

            for ( var i = 4; i>=0; i--)
            {

                if( make_admin[i] == "" )
                {
                    make_admin.splice(i,1);
                    make_aid.splice(i,1);
                    make_aclass.splice(i,1);
                }
            }
            //组成对象
            var all_admin = [make_admin,make_aid,make_aclass,make_admin.length];

            var get_all = JSON.stringify(all_admin);
                $.ajax({
                    url: 'form.php',
                    data: {
                        m: 'set_infor',
                        type: data.field.type,
                        u_name: data.field.u_name,
                        a_name: data.field.a_name,
                        manager: data.field.manager,
                        m_phone: data.field.m_phone,
                        m_class: data.field.m_class,
                        m_id: data.field.m_id,
                        admin: all_admin,
                        time: data.field.time,
                        b_position: data.field.b_position,
                        u_position: data.field.u_position,
                        d_position: data.field.d_position,
                        a_position: data.field.a_position,
                        flag: the_flag,
                        url: data.field.url
                    },
                    type: 'POST',
                    success: function () {
                        $('#page_one').css({'display':'none'});
                        $('#page_two').css({'display':'block','height':'437px'});
                        $('#page_body').css({'position':'120px','top':'120px'});
                        gogogo();
                    },
                    error: function (XMLHttpRequest, textStatus) {
                        alert("报名出错，请联系管理员"+ textStatus);
                    }
                });

                return false;
            });


    });
</script><!--表单提交相关-->

<script>
    //作品名称检测
    $(":text[name=no_name]").bind('input propertychange', function() {
        localStorage.setItem('the_val',$(":text[name=no_name]").val());
        $.ajax({
            type: "post",
            url: 'form.php',
            data:{
                m:'flag',
                a_name: localStorage.getItem('the_val')
            },
            success: function(data){
                var new_data = JSON.parse(data);
                if ( new_data.flag == 1 ) {
                    var get_tip = "<span style='color: #ff5722'>相同作品名已报名</span>";
                    localStorage.setItem('the_val','');
                } else {
                    var get_tip = '';
                }
                $('#the_tip').html(get_tip);
                $(":text[name=a_name]").attr("value",localStorage.getItem('the_val'));
            }
        })
    });

    //添加表单元素
    localStorage.setItem('the_add',1);
    $("#the_more").click(function () {
        var the_add = Number(localStorage.getItem('the_add'));
        ++the_add;
        if (the_add<=5){
            var add_ele = '<div class="layui-form-item baby" id="add_input"><div class="layui-inline"><label class="layui-form-label">参与人员信息'+ the_add +'</label><div class="layui-input-inline" style="width: 100px;"><input type="text" name="admin'+ the_add +'" placeholder="姓名" autocomplete="off" class="layui-input" lay-verify="name"></div><div class="layui-form-mid">-</div><div class="layui-input-inline" style="width: 100px;"><input type="text" name="a_id' + the_add + '" placeholder="学号" lay-verify="name_id" autocomplete="off" class="layui-input"></div><div class="layui-form-mid">-</div><div class="layui-input-inline" style="width: 100px;"><input type="text" name="a_class' + the_add + '" lay-verify="class_id" placeholder="部门/班级" autocomplete="off" class="layui-input"></div></div>'
            $('#add_input').after(add_ele);

        } else {
            the_add = 6;
        }
        localStorage.setItem('the_add',the_add);
        form.render(null,'test2');
    });

    //删除表单元素
    $("#the_del").click(function () {
        var get_add = Number(localStorage.getItem('the_add'));
        if(get_add>1 && get_add<6)
        {
            $('.baby:first').remove();
            get_add = get_add - 1;
        } else if( get_add==6 )
        {
            $('.baby:first').remove();
            get_add = get_add - 2;
        } else {}
        localStorage.setItem('the_add',get_add);
        form.render(null,'test2');
    });

</script><!--检测相关-->


</body>
</html>